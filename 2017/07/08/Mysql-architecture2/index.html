<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>3. Mysql 아키텍처 CH 3.2, CH 3.3 | Wonny's note</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">3. Mysql 아키텍처 CH 3.2, CH 3.3</h1><a id="logo" href="/.">Wonny's note</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">3. Mysql 아키텍처 CH 3.2, CH 3.3</h1><div class="post-meta">Jul 8, 2017<span> | </span><span class="category"><a href="/categories/Mysql/">Mysql</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h1 id="3-2-InnoDB-스토리지-엔진-아키텍처"><a href="#3-2-InnoDB-스토리지-엔진-아키텍처" class="headerlink" title="3.2 InnoDB 스토리지 엔진 아키텍처"></a>3.2 InnoDB 스토리지 엔진 아키텍처</h1><h2 id="3-2-1-InnoDB-스토리지-엔진의-특성"><a href="#3-2-1-InnoDB-스토리지-엔진의-특성" class="headerlink" title="3.2.1 InnoDB 스토리지 엔진의 특성"></a>3.2.1 InnoDB 스토리지 엔진의 특성</h2><h3 id="PK에-의한-클러스터링"><a href="#PK에-의한-클러스터링" class="headerlink" title="PK에 의한 클러스터링"></a>PK에 의한 클러스터링</h3><p>InnoDB의 모든 데이터 테이블은 기본적으로 프라이머리 키를 기준으로 클러스터링 되어 저장된다. 즉 PK값의 순서대로 디스크에 저장된다는 의미이며, 이로 인해 PK에 의한 레인지 스캔은 상당히 빨리 처리될 수 있다.</p>
<h3 id="잠금이-필요없는-일관된-읽기"><a href="#잠금이-필요없는-일관된-읽기" class="headerlink" title="잠금이 필요없는 일관된 읽기"></a>잠금이 필요없는 일관된 읽기</h3><p>InnoDB는 MVCC(Multi Version Concurrency Control)라는 기술을 이용해 락을 걸지 않고 읽기 작업을 수행한다.</p>
<h3 id="외래-키-지원"><a href="#외래-키-지원" class="headerlink" title="외래 키 지원"></a>외래 키 지원</h3><p>InnoDB에서는 외래키를 지원하지만 실무에서는 여러가지 제약때문에 잘 사용하지 않다. 하지만 데이터베이스의 좋은 가이드 역할로 사용이 가능하다.</p>
<h3 id="자동-데드락-감지"><a href="#자동-데드락-감지" class="headerlink" title="자동 데드락 감지"></a>자동 데드락 감지</h3><p>InnoDB는 그래프 기반의 데드락 체크 방식을 사용하기 때문에 데드락이 발생함과 동시에 바로 감지되고, 감지된 데드락은 관련 트랜잭션 중에서 rollback 이 가장 용이한 트랜잭션을 자동적으로 강제 종료해 버린다.</p>
<h3 id="자동화된-장애-복구"><a href="#자동화된-장애-복구" class="headerlink" title="자동화된 장애 복구"></a>자동화된 장애 복구</h3><h3 id="오라클의-아키텍처-적용"><a href="#오라클의-아키텍처-적용" class="headerlink" title="오라클의 아키텍처 적용"></a>오라클의 아키텍처 적용</h3><h2 id="3-2-2-InnoDB-버퍼-풀"><a href="#3-2-2-InnoDB-버퍼-풀" class="headerlink" title="3.2.2 InnoDB 버퍼 풀"></a>3.2.2 InnoDB 버퍼 풀</h2><p>InnoDB 스토리지 엔젠에서 가장 핵심적인 부분으로, 디스크의 데이터 파일이나 인덱스 정보를 메모리에 캐시해 두는 공간이다. MyISAM 키 캐시가 인덱스의 캐시만을 주로 처리하는데 비해 InnoDB의 버퍼 풀은 데이터와 인덱스 모두 캐시하고 쓰기 버퍼링의 역할까지 모두 처리하고 있는 것이다.</p>
<h2 id="3-2-3-Undo-로그"><a href="#3-2-3-Undo-로그" class="headerlink" title="3.2.3 Undo 로그"></a>3.2.3 Undo 로그</h2><p>언두 영역은 update, delete와 같은 문장으로 데이터를 변경했을 때 변경되기 전의 데이터를 보관하는 곳이다.</p>
<p>언두의 데이터는 크게 두가지 용도로 사용되는데, 첫 번째가 트랜잭션의 롤백 대비용, 두 번째는 트랜잭션의 격리 수준을 유지하면서 높은 동시성을 제공하는 데 사용된다. 트랜잭션의 격리 수준이라는 개념이 있는데, 이는 동시에 여러 트랜잭션이 데이터를 변경하거나 조회할 때, 한 트랜잭션의 작업 내용이 다른 트랜잭션에 어떻게 보여질지를 결정하는 기준이다.</p>
<h2 id="3-2-4-Insert-Buffer"><a href="#3-2-4-Insert-Buffer" class="headerlink" title="3.2.4 Insert Buffer"></a>3.2.4 Insert Buffer</h2><p>RDBMS에서 레코드가 insert 되거나 update 될때 데이터 파일을 변경하는 작업뿐 아니라 해당 테이블에 포함된 인덱스를 업데이트 하는 작업도 필요하다. 그런 인덱스를 업데이트 하는 작업은 랜덤하게 디스크를 읽는 작업이 필요하므로 테이블에 인덱스가 많다면 이 작업은 상당히 많은 자원을 소모하게 된다. InnoDB는 변경해야 할 인덱스 페이지가 버퍼 풀에 있으면 바로 업데이트를 수행하지만, 그렇지 않고 디스크로 부터 읽어와서 업데이트해야 한다면 이를 즉시 실행하지 않고 임시 공간에 저장해 두고 바로 사용자에게 결과를 반환하는 형태로 성능을 향상시키게 되는데, 이때 사용하는 임시 메모리 공간을 인서트 버퍼(Insert Buffer) 라고 한다.</p>
<h2 id="3-2-5-Redo-로그-및-로그-버퍼"><a href="#3-2-5-Redo-로그-및-로그-버퍼" class="headerlink" title="3.2.5 Redo 로그 및 로그 버퍼"></a>3.2.5 Redo 로그 및 로그 버퍼</h2><p>쿼리 문장으로 데이터를 변경하고 커밋하면 DBMS는 데이터의 ACID를 보장하기 위해 즉시 변경된 데이터의 내용을 데이터 파일로 기록해야 한다. 하지만 이런 작업은 랜덤하게 디스크에 기록해야 하므로 디스크를 바쁘게 만드는 작업이다. 그래서 대부분의 DBMS에는 변경된 데이터를 버퍼링해 두기 위해 InnoDB 버퍼 풀과 같은 장치가 포함되어 있다. 하지만 이 장치만으로는 ACID를 보장할 수 없는데 이를 위해 변경된 내용을 순차적으로 디스크에 기록하는 로그 파일을 가지고 있다. 이를 <strong>리두 로그</strong> 라고 한다.</p>
<p>하지만 사용량이 많은 DBMS 서버의 경우 이 리두 로그의 기록 작업이 큰 문제가 되는데, 이러한 부분을 보완하기 위한 로그 버퍼링이 존재하는데 이 로그 버퍼링에 사용되는 공간이 <strong>로그 버퍼</strong> 이다.</p>
<h2 id="3-2-6-MVCC-Multi-Version-Concurrency-Control"><a href="#3-2-6-MVCC-Multi-Version-Concurrency-Control" class="headerlink" title="3.2.6 MVCC(Multi Version Concurrency Control)"></a>3.2.6 MVCC(Multi Version Concurrency Control)</h2><p>MVCC는 잠금을 사용하지 않는 일관된 읽기를 제공하는데 있다. InnoDB에서는 언두 로그를 이용해 이 기능을 구현한다. </p>
<p>update 문장이 실행될 때 기존의 데이터는 언두 로그에 기록되며 새로운 데이터는 InnoDB 버퍼 풀에 기록된다. 즉 하나의 레코드에 대해 두가지 버전의 데이터가 있으며 select문을 이용해 조회를 할 경우 보여지는 데이터는 격리수준에 따라 다르다. </p>
<p>최종적으로 commit 이 되면 레코드의 테이터를 바꾸고, rollback 을 하면 언두 영역에 있는 데이터를 버퍼 풀로 가져온다. 즉 커밋이 된다고 언두 영역의 데이터가 바로 삭제되는게 아니다. 이 언두 영역을 필요로 하는 트랜잭션이 더는 필요 없을 때 비로소 삭제된다.</p>
<h2 id="3-2-7-잠금이-없는-일관된-읽기"><a href="#3-2-7-잠금이-없는-일관된-읽기" class="headerlink" title="3.2.7 잠금이 없는 일관된 읽기"></a>3.2.7 잠금이 없는 일관된 읽기</h2><p>특정 사용자가 레코드를 변경하고 아직 커밋을 수행하지 않았다 하더라도 이 변경 트랜잭션이 다른 사용자의 select 작업을 방해하지 않는다. 이를 잠금이 없는 일관된 읽기 라고 표현하며 InnoDB에서는 언두 로그를 사용하여 구현한다.</p>
<h1 id="3-3-MyISAM-스토리지-엔진-아키텍처"><a href="#3-3-MyISAM-스토리지-엔진-아키텍처" class="headerlink" title="3.3 MyISAM 스토리지 엔진 아키텍처"></a>3.3 MyISAM 스토리지 엔진 아키텍처</h1><h2 id="3-3-1-키-캐시"><a href="#3-3-1-키-캐시" class="headerlink" title="3.3.1 키 캐시"></a>3.3.1 키 캐시</h2><p>InnoDB의 버퍼 풀과 비슷한 역할을 하는 것이 MyISAM의 키 캐시다. 하지만 키 캐시는 인덱스만 대상으로 작동하며 인덱스의 디스크 쓰기 작업에 대해서만 부분적으로 버퍼링 역할을 한다.</p>
<h2 id="3-3-2-운영체제의-캐시-및-버퍼"><a href="#3-3-2-운영체제의-캐시-및-버퍼" class="headerlink" title="3.3.2 운영체제의 캐시 및 버퍼"></a>3.3.2 운영체제의 캐시 및 버퍼</h2><p>MyISAM 테이블의 인덱스는 키 캐시를 이용해 디스크를 검색하지 않고도 충분히 빠르게 검색할 수 있다. 하지만 MyISAM 테이블의 데이터는 디스크로부터의 I/O를 해결해 줄 만한 어떠한 캐시나 버퍼링 기능이 없다. 그래서 운영체제의 디스크 읽기/쓰기 작업으로 요청될 수 밖에 없다. 운영체제의 캐시 기능은 InnoDB 같이 데이터의 특성을 알고 전문적으로 캐시나 버퍼링을 하지는 못하지만 그래도 없는 것 보다는 낫다. 운영체제의 캐시 공간은 남는 메모리를 사용하는 것이 기본 원칙이다.</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://jumpegg.github.io/2017/07/08/Mysql-architecture2/" data-id="cj4vf6yhg0000gkufsb3pyeek" class="article-share-link">Share</a><div class="tags"><a href="/tags/Mysql/">Mysql</a></div><div class="post-nav"><a href="/2017/07/08/Mysql-architecture3/" class="pre">3. Mysql 아키텍처 CH 3.4, CH 3.5, CH 3.6</a><a href="/2017/07/08/Mysql-architecture/" class="next">3. Mysql 아키텍쳐 CH 3.1</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ionic2/">ionic2</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/ionic2-nav/" style="font-size: 15px;">ionic2, nav</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/07/08/Mysql-architecture4/">3. Mysql 아키텍처 3.7, 3.8</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/08/Mysql-architecture3/">3. Mysql 아키텍처 CH 3.4, CH 3.5, CH 3.6</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/08/Mysql-architecture2/">3. Mysql 아키텍처 CH 3.2, CH 3.3</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/08/Mysql-architecture/">3. Mysql 아키텍쳐 CH 3.1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/07/ionic-nav/">Ionic 간단한 nav 개념잡기</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/06/start/">Hexo 를 시작해보자</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://textshare.io" title="textshare.io" target="_blank">textshare.io</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Wonny's note.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>